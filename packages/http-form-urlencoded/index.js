"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const SymTransform = Symbol('transform');
const SymOptions = Symbol('options');
class LazyURLSearchParams extends URLSearchParams {
    constructor(init, options) {
        if (!options) {
            if (init instanceof LazyURLSearchParams) {
                options = Object.assign({}, init[SymOptions]);
            }
            else {
                options = {};
            }
        }
        if (options.transform == null) {
            options.transform = true;
        }
        super(_core(init, options));
        this[SymOptions] = options;
    }
    [SymTransform](value, options) {
        options = options || this[SymOptions];
        return transformValue(value, options);
    }
    /**
     * all null value will transform to ''
     */
    append(name, value, options) {
        options = options || this[SymOptions];
        if (options.transform) {
            value = this[SymTransform](value, options);
        }
        super.append(name, value);
    }
    /**
     * all null value will transform to ''
     */
    set(name, value, options) {
        options = options || this[SymOptions];
        if (options.transform) {
            value = this[SymTransform](value, options);
        }
        super.set(name, value);
    }
    /**
     * append
     */
    push(...values) {
        values.forEach(([k, v]) => this.append(k, v));
    }
    /**
     * set
     */
    extend(values, options) {
        Object.entries(values).forEach(([k, v]) => this.set(k, v, options));
    }
    clone() {
        return new LazyURLSearchParams(this);
    }
    toString() {
        return super.toString();
    }
}
exports.LazyURLSearchParams = LazyURLSearchParams;
function _core(init, options) {
    options = options || {};
    //console.dir(options);
    if (typeof init != 'string' && options.transform && !(init instanceof URLSearchParams) && init) {
        const { emptyValueToKeyOnly } = options;
        if (!Array.isArray(init)) {
            init = Object.entries(init);
        }
        let arr = init.reduce((arr, [key, value]) => {
            if (value == null || emptyValueToKeyOnly && value === '') {
                arr.push(transformKey(key));
            }
            else {
                let u = new URLSearchParams();
                u.append(key, transformValue(value, options));
                arr.push(u.toString());
            }
            return arr;
        }, []);
        init = arr.join('&');
    }
    else if (init == null) {
        init = void 0;
    }
    //console.dir(init);
    return init;
}
exports._core = _core;
function transformKey(value) {
    return encodeURIComponent(value);
}
exports.transformKey = transformKey;
function transformValue(value, options) {
    if (value == null) {
        if (options && options.allowNull) {
            return value;
        }
        return '';
    }
    else if (typeof value === 'object') {
        return JSON.stringify(value);
    }
    return value.toString();
}
exports.transformValue = transformValue;
exports.default = LazyURLSearchParams;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUtBLE1BQU0sWUFBWSxHQUFHLE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQztBQUN6QyxNQUFNLFVBQVUsR0FBRyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUM7QUFtQnJDLE1BQWEsbUJBQW9CLFNBQVEsZUFBZTtJQVV2RCxZQUFZLElBQTJCLEVBQUUsT0FBa0I7UUFFMUQsSUFBSSxDQUFDLE9BQU8sRUFDWjtZQUNDLElBQUksSUFBSSxZQUFZLG1CQUFtQixFQUN2QztnQkFDQyxPQUFPLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxFQUFFLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUM7YUFDOUM7aUJBRUQ7Z0JBQ0MsT0FBTyxHQUFHLEVBQUUsQ0FBQzthQUNiO1NBQ0Q7UUFFRCxJQUFJLE9BQU8sQ0FBQyxTQUFTLElBQUksSUFBSSxFQUM3QjtZQUNDLE9BQU8sQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDO1NBQ3pCO1FBRUQsS0FBSyxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQztRQUU1QixJQUFJLENBQUMsVUFBVSxDQUFDLEdBQUcsT0FBTyxDQUFDO0lBQzVCLENBQUM7SUE3QkQsQ0FBQyxZQUFZLENBQUMsQ0FBQyxLQUFVLEVBQUUsT0FBa0I7UUFFNUMsT0FBTyxHQUFHLE9BQU8sSUFBSSxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7UUFFdEMsT0FBTyxjQUFjLENBQUMsS0FBSyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQ3ZDLENBQUM7SUEwQkQ7O09BRUc7SUFDSCxNQUFNLENBQUMsSUFBWSxFQUFFLEtBQW1CLEVBQUUsT0FBa0I7UUFFM0QsT0FBTyxHQUFHLE9BQU8sSUFBSSxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7UUFFdEMsSUFBSSxPQUFPLENBQUMsU0FBUyxFQUNy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QUNDLElBQUksR0FBRyxLQUFLLENBQUMsQ0FBQztLQUNkO0lBRUQsb0JBQW9CO0lBRXBCLE9BQU8sSUFBSSxDQUFDO0FBQ2IsQ0FBQztBQXpDRCxzQkF5Q0M7QUFFRCxTQUFnQixZQUFZLENBQUMsS0FBYTtJQUV6QyxPQUFPLGtCQUFrQixDQUFDLEtBQUssQ0FBQyxDQUFBO0FBQ2pDLENBQUM7QUFIRCxvQ0FHQztBQUVELFNBQWdCLGNBQWMsQ0FBQyxLQUFVLEVBQUUsT0FBa0I7SUFFNUQsSUFBSSxLQUFLLElBQUksSUFBSSxFQUNqQjtRQUNDLElBQUksT0FBTyxJQUFJLE9BQU8sQ0FBQyxTQUFTLEVBQ2hDO1lBQ0MsT0FBTyxLQUFLLENBQUE7U0FDWjtRQUVELE9BQU8sRUFBRSxDQUFDO0tBQ1Y7U0FDSSxJQUFJLE9BQU8sS0FBSyxLQUFLLFFBQVEsRUFDbEM7UUFDQyxPQUFPLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUE7S0FDNUI7SUFFRCxPQUFPLEtBQUssQ0FBQyxRQUFRLEVBQUUsQ0FBQztBQUN6QixDQUFDO0FBakJELHdDQWlCQztBQUVELGtCQUFlLG1CQUFtQixDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDcmVhdGVkIGJ5IHVzZXIgb24gMjAxOS82LzkuXG4gKi9cbmltcG9ydCB7IElUU0FycmF5TGlzdE1heWJlUmVhZG9ubHksIElUU1ZhbHVlT3JBcnJheSB9IGZyb20gJ3RzLXR5cGUnO1xuXG5jb25zdCBTeW1UcmFuc2Zvcm0gPSBTeW1ib2woJ3RyYW5zZm9ybScpO1xuY29uc3QgU3ltT3B0aW9ucyA9IFN5bWJvbCgnb3B0aW9ucycpO1xuXG5leHBvcnQgaW50ZXJmYWNlIElPcHRpb25zXG57XG5cdC8qKlxuXHQgKiAnJms9JnY9MScgPT4gJyZrJnY9MSdcblx0ICogb25seSB3b3JrIGZvciBjcmVhdGUgbmV3XG5cdCAqL1xuXHRlbXB0eVZhbHVlVG9LZXlPbmx5PzogYm9vbGVhbixcblx0LyoqXG5cdCAqIHRyYW5zZm9ybSB2YWx1ZSB0byB4LXd3dy1mb3JtLXVybGVuY29kZWRcblx0ICovXG5cdHRyYW5zZm9ybT86IGJvb2xlYW4sXG5cblx0YWxsb3dOdWxsPzogYm9vbGVhbixcbn1cblxuZXhwb3J0IHR5cGUgSVVSTFNlYXJjaFBhcmFtc0luaXQgPSBhbnlbXVtdIHwgW2FueSwgYW55XVtdIHwgUmVjb3JkPHN0cmluZywgYW55PiB8IHN0cmluZyB8IFVSTFNlYXJjaFBhcmFtcztcblxuZXhwb3J0IGNsYXNzIExhenlVUkxTZWFyY2hQYXJhbXMgZXh0ZW5kcyBVUkxTZWFyY2hQYXJhbXMgaW1wbGVtZW50cyBVUkxTZWFyY2hQYXJhbXNcbntcblx0W1N5bU9wdGlvbnNdOiBJT3B0aW9ucztcblx0W1N5bVRyYW5zZm9ybV0odmFsdWU6IGFueSwgb3B0aW9ucz86IElPcHRpb25zKVxuXHR7XG5cdFx0b3B0aW9ucyA9IG9wdGlvbnMgfHwgdGhpc1tTeW1PcHRpb25zXTtcblxuXHRcdHJldHVybiB0cmFuc2Zvcm1WYWx1ZSh2YWx1ZSwgb3B0aW9ucyk7XG5cdH1cblxuXHRjb25zdHJ1Y3Rvcihpbml0PzogSVVSTFNlYXJjaFBhcmFtc0luaXQsIG9wdGlvbnM/OiBJT3B0aW9ucylcblx0e1xuXHRcdGlmICghb3B0aW9ucylcblx0XHR7XG5cdFx0XHRpZiAoaW5pdCBpbnN0YW5jZW9mIExhenlVUkxTZWFyY2hQYXJhbXMpXG5cdFx0XHR7XG5cdFx0XHRcdG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHt9LCBpbml0W1N5bU9wdGlvbnNdKTtcblx0XHRcdH1cblx0XHRcdGVsc2Vcblx0XHRcdHtcblx0XHRcdFx0b3B0aW9ucyA9IHt9O1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmIChvcHRpb25zLnRyYW5zZm9ybSA9PSBudWxsKVxuXHRcdHtcblx0XHRcdG9wdGlvbnMudHJhbnNmb3JtID0gdHJ1ZTtcblx0XHR9XG5cblx0XHRzdXBlcihfY29yZShpbml0LCBvcHRpb25zKSk7XG5cblx0XHR0aGlzW1N5bU9wdGlvbnNdID0gb3B0aW9ucztcblx0fVxuXG5cdC8qKlxuXHQgKiBhbGwgbnVsbCB2YWx1ZSB3aWxsIHRyYW5zZm9ybSB0byAnJ1xuXHQgKi9cblx0YXBwZW5kKG5hbWU6IHN0cmluZywgdmFsdWU6IHN0cmluZyB8IGFueSwgb3B0aW9ucz86IElPcHRpb25zKVxuXHR7XG5cdFx0b3B0aW9ucyA9IG9wdGlvbnMgfHwgdGhpc1tTeW1PcHRpb25zXTtcblxuXHRcdGlmIChvcHRpb25zLnRyYW5zZm9ybSlcblx0XHR7XG5cdFx0XHR2YWx1ZSA9IHRoaXNbU3ltVHJhbnNmb3JtXSh2YWx1ZSwgb3B0aW9ucylcblx0XHR9XG5cblx0XHRzdXBlci5hcHBlbmQobmFtZSwgdmFsdWUgYXMgYW55KVxuXHR9XG5cblx0LyoqXG5cdCAqIGFsbCBudWxsIHZhbHVlIHdpbGwgdHJhbnNmb3JtIHRvICcnXG5cdCAqL1xuXHRzZXQobmFtZTogc3RyaW5nLCB2YWx1ZTogc3RyaW5nIHwgYW55LCBvcHRpb25zPzogSU9wdGlvbnMpXG5cdHtcblx0XHRvcHRpb25zID0gb3B0aW9ucyB8fCB0aGlzW1N5bU9wdGlvbnNdO1xuXG5cdFx0aWYgKG9wdGlvbnMudHJhbnNmb3JtKVxuXHRcdHtcblx0XHRcdHZhbHVlID0gdGhpc1tTeW1UcmFuc2Zvcm1dKHZhbHVlLCBvcHRpb25zKVxuXHRcdH1cblxuXHRcdHN1cGVyLnNldChuYW1lLCB2YWx1ZSBhcyBhbnkpXG5cdH1cblxuXHQvKipcblx0ICogYXBwZW5kXG5cdCAqL1xuXHRwdXNoKC4uLnZhbHVlczogSVRTQXJyYXlMaXN0TWF5YmVSZWFkb25seTx1bmtub3duPltdKVxuXHR7XG5cdFx0dmFsdWVzLmZvckVhY2goKFtrLCB2XSkgPT4gdGhpcy5hcHBlbmQoayBhcyBzdHJpbmcsIHYpKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBzZXRcblx0ICovXG5cdGV4dGVuZCh2YWx1ZXM6IFJlY29yZDxhbnksIGFueT4sIG9wdGlvbnM/OiBJT3B0aW9ucylcblx0e1xuXHRcdE9iamVjdC5lbnRyaWVzKHZhbHVlcykuZm9yRWFjaCgoW2ssIHZdKSA9PiB0aGlzLnNldChrIGFzIHN0cmluZywgdiwgb3B0aW9ucykpO1xuXHR9XG5cblx0Y2xvbmU8VCBleHRlbmRzIFVSTFNlYXJjaFBhcmFtcyA9IExhenlVUkxTZWFyY2hQYXJhbXM+KCk6IFRcblx0e1xuXHRcdHJldHVybiBuZXcgTGF6eVVSTFNlYXJjaFBhcmFtcyh0aGlzKSBhcyBhbnlcblx0fVxuXG5cdHRvU3RyaW5nKClcblx0e1xuXHRcdHJldHVybiBzdXBlci50b1N0cmluZygpO1xuXHR9XG5cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIF9jb3JlKGluaXQ/OiBJVVJMU2VhcmNoUGFyYW1zSW5pdCwgb3B0aW9ucz86IElPcHRpb25zKVxue1xuXHRvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcblxuXHQvL2NvbnNvbGUuZGlyKG9wdGlvbnMpO1xuXG5cdGlmICh0eXBlb2YgaW5pdCAhPSAnc3RyaW5nJyAmJiBvcHRpb25zLnRyYW5zZm9ybSAmJiAhKGluaXQgaW5zdGFuY2VvZiBVUkxTZWFyY2hQYXJhbXMpICYmIGluaXQpXG5cdHtcblx0XHRjb25zdCB7IGVtcHR5VmFsdWVUb0tleU9ubHkgfSA9IG9wdGlvbnM7XG5cblx0XHRpZiAoIUFycmF5LmlzQXJyYXkoaW5pdCkpXG5cdFx0e1xuXHRcdFx0aW5pdCA9IE9iamVjdC5lbnRyaWVzKGluaXQpXG5cdFx0fVxuXG5cdFx0bGV0IGFyciA9IChpbml0IGFzIFtzdHJpbmcsIHVua25vd25dW10pLnJlZHVjZSgoYXJyLCBba2V5LCB2YWx1ZV0pID0+IHtcblxuXHRcdFx0aWYgKHZhbHVlID09IG51bGwgfHwgZW1wdHlWYWx1ZVRvS2V5T25seSAmJiB2YWx1ZSA9PT0gJycpXG5cdFx0XHR7XG5cdFx0XHRcdGFyci5wdXNoKHRyYW5zZm9ybUtleShrZXkpKTtcblx0XHRcdH1cblx0XHRcdGVsc2Vcblx0XHRcdHtcblx0XHRcdFx0bGV0IHUgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKCk7XG5cdFx0XHRcdHUuYXBwZW5kKGtleSwgdHJhbnNmb3JtVmFsdWUodmFsdWUsIG9wdGlvbnMpKTtcblx0XHRcdFx0YXJyLnB1c2godS50b1N0cmluZygpKTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIGFycjtcblx0XHR9LCBbXSBhcyBzdHJpbmdbXSlcblxuXHRcdGluaXQgPSBhcnIuam9pbignJicpO1xuXHR9XG5cdGVsc2UgaWYgKGluaXQgPT0gbnVsbClcblx0e1xuXHRcdGluaXQgPSB2b2lkIDA7XG5cdH1cblxuXHQvL2NvbnNvbGUuZGlyKGluaXQpO1xuXG5cdHJldHVybiBpbml0O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gdHJhbnNmb3JtS2V5KHZhbHVlOiBzdHJpbmcpXG57XG5cdHJldHVybiBlbmNvZGVVUklDb21wb25lbnQodmFsdWUpXG59XG5cbmV4cG9ydCBmdW5jdGlvbiB0cmFuc2Zvcm1WYWx1ZSh2YWx1ZTogYW55LCBvcHRpb25zPzogSU9wdGlvbnMpXG57XG5cdGlmICh2YWx1ZSA9PSBudWxsKVxuXHR7XG5cdFx0aWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5hbGxvd051bGwpXG5cdFx0e1xuXHRcdFx0cmV0dXJuIHZhbHVlXG5cdFx0fVxuXG5cdFx0cmV0dXJuICcnO1xuXHR9XG5cdGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcpXG5cdHtcblx0XHRyZXR1cm4gSlNPTi5zdHJpbmdpZnkodmFsdWUpXG5cdH1cblxuXHRyZXR1cm4gdmFsdWUudG9TdHJpbmcoKTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgTGF6eVVSTFNlYXJjaFBhcmFtc1xuIl19